# Swagger/OpenAPI документация

## Обзор

Микросервис micro-stt предоставляет полную OpenAPI (Swagger) документацию для всех эндпоинтов API.

## Доступ к документации

После запуска сервиса документация доступна по адресу:

```
http://localhost:3000/api/docs
```

Где:

- `localhost:3000` - адрес и порт, настраиваемые через `LISTEN_HOST` и `LISTEN_PORT` (в примере использованы значения для development)
- `/api/docs` - фиксированный путь к Swagger UI

> **Примечание:** В production по умолчанию используется `0.0.0.0:80`, настройте соответствующие переменные окружения.

## Возможности Swagger UI

### 1. Интерактивное тестирование API

Swagger UI позволяет отправлять запросы непосредственно из браузера:

1. Откройте любой эндпоинт (например, `POST /api/v1/transcriptions/file`)
2. Нажмите кнопку **"Try it out"**
3. Заполните параметры запроса
4. Нажмите **"Execute"**
5. Просмотрите ответ сервера

### 2. Схемы данных

Все DTO (Data Transfer Objects) документированы с:

- Описанием каждого поля
- Типом данных
- Примерами значений
- Указанием обязательности/опциональности
- Возможными значениями (для enum)

### 3. Коды ответов

Для каждого эндпоинта документированы все возможные коды ответа:

- `200` - Успешный ответ
- `400` - Неверные параметры запроса
- `401` - Отсутствует или неверный API ключ
- `503` - Сервис транскрибации недоступен
- `504` - Превышено время ожидания транскрибации

### 4. Примеры запросов и ответов

Каждый эндпоинт содержит примеры:

- Структуры запроса (Request Body)
- Успешных ответов
- Ответов с ошибками

## Основные теги (группы эндпоинтов)

### Transcriptions

Эндпоинты для работы с транскрибацией аудио:

- `POST /api/v1/transcriptions/file` - Транскрибация аудиофайла по URL

**Параметры:**

- `audioUrl` (обязательный) - URL аудиофайла
- `provider` (опциональный) - Провайдер STT (по умолчанию: assemblyai)
- `timestamps` (опциональный) - Включить временные метки на уровне слов
- `apiKey` (опциональный) - Пользовательский API ключ провайдера

### Health

Эндпоинты для мониторинга состояния сервиса:

- `GET /health` - Полная проверка здоровья сервиса
- `GET /health/ready` - Проверка готовности к обработке запросов (readiness probe)
- `GET /health/live` - Проверка работоспособности сервиса (liveness probe)

## Экспорт документации

### OpenAPI JSON

Полная спецификация OpenAPI доступна в формате JSON:

```
http://localhost:3000/api/docs-json
```

### Использование в других инструментах

Спецификацию можно импортировать в:

- **Postman** - коллекции API запросов
- **Insomnia** - REST клиент
- **OpenAPI Generator** - генерация клиентов для различных языков
- **Swagger Editor** - редактирование спецификации

## Настройки Swagger UI

Текущие настройки:

```typescript
{
  persistAuthorization: true,  // Сохранение авторизации между сессиями
  tagsSorter: 'alpha',          // Сортировка тегов по алфавиту
  operationsSorter: 'alpha',    // Сортировка операций по алфавиту
  docExpansion: 'list',         // Отображение только списка эндпоинтов
  filter: true,                 // Включить фильтр поиска
  showRequestDuration: true,    // Показывать время выполнения запросов
}
```

## Безопасность

⚠️ **Важно**: В production окружении рекомендуется:

- Закрыть доступ к `/api/docs` для публичного доступа
- Использовать аутентификацию для доступа к документации
- Или полностью отключить Swagger UI

Для отключения документации в production добавьте проверку окружения в `main.ts`:

```typescript
if (appConfig.nodeEnv !== 'production') {
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api/docs', app, document, options);
}
```

## Дополнительная информация

- **Версия Swagger**: @nestjs/swagger@11.2.1
- **Спецификация**: OpenAPI 3.0
- **UI**: Swagger UI
- **Контакт**: Ivan K.
- **Лицензия**: MIT
